{% extends 'base.html' %}
{% load static %}

{% block title %}Cart - Mocajo Fashion{% endblock %}
{% block link %}<link rel="stylesheet" href="{% static 'css/cart.css' %}">  {% endblock %}
{% block content %}
<section class="py-3 py-lg-4">
  <div class="container">

    <div class="section-head mb-3">
      <h2 class="section-title">Your Cart</h2>
      <p class="section-sub mb-0">Review items and proceed to checkout</p>
    </div>

    {% if not cart_items %}
      <div class="empty-card">
        <div class="empty-icon">
          <i class="fas fa-shopping-bag"></i>
        </div>
        <h4 class="mb-2">Your cart is empty</h4>
        <p class="text-muted mb-4">Browse our latest collections and add items to your cart.</p>
        <a class="btn btn-sage" href="{% url 'moc_app:index' %}">Start shopping</a>
      </div>
    {% else %}

      <div class="row g-4 align-items-start">
        <!-- CART LIST -->
        <div class="col-lg-8">

          <div class="cart-card">
            <div class="cart-head">
              <div>
                <h5 class="mb-0">Cart items</h5>
                <div class="cart-sub">Items: <b>{{ counter }}</b></div>
              </div>

              <a class="btn btn-sage-outline btn-sm" href="{% url 'moc_app:index' %}">
                <i class="fas fa-arrow-left me-2"></i>Continue shopping
              </a>
            </div>

            <div class="cart-body">
              {% for cart_item in cart_items %}
                <div class="cart-row">
                  <a class="cart-img" href="{{ cart_item.product.get_url }}">
                    <img src="{{ cart_item.product.img.url }}" alt="{{ cart_item.product.name }}">
                  </a>

                  <div class="cart-info">
                    <a class="cart-name" href="{{ cart_item.product.get_url }}">{{ cart_item.product.name }}</a>

                    <div class="cart-meta">
                      <span>₹{{ cart_item.product.price }}</span>
                      <span class="dot">•</span>
                      <span>SKU {{ cart_item.product.id }}</span>
                    </div>

                    <div class="cart-variant">
                      {% if cart_item.size %}<span class="variant-pill">Size: {{ cart_item.size }}</span>{% endif %}
                      {% if cart_item.color %}<span class="variant-pill">Color: {{ cart_item.color }}</span>{% endif %}
                    </div>

                    <a href="{% url 'cart_app:cart_delete' cart_item.id %}" class="remove-link">
                      <i class="fas fa-trash me-1"></i>Remove
                    </a>
                  </div>

                  <div class="cart-controls">
                    <div class="qty-stepper" role="group" aria-label="quantity">
                      <a href="{% url 'cart_app:cart_remove' cart_item.id %}" class="qty-btn" aria-label="decrease">
                        <i class="fas fa-minus"></i>
                      </a>

                      <div class="qty-count" aria-label="quantity">{{ cart_item.quantity }}</div>

                      {% if cart_item.quantity < cart_item.product.stock %}
                        <form action="{% url 'cart_app:addcart' cart_item.product.id %}" method="post" class="m-0">
                          {% csrf_token %}
                          <input type="hidden" name="size" value="{{ cart_item.size }}">
                          <input type="hidden" name="color" value="{{ cart_item.color }}">
                          <button class="qty-btn" type="submit" aria-label="increase">
                            <i class="fas fa-plus"></i>
                          </button>
                        </form>
                      {% else %}
                        <button class="qty-btn" type="button" disabled aria-label="no more stock">
                          <i class="fas fa-plus"></i>
                        </button>
                      {% endif %}
                    </div>

                    <div class="line-total">
                      <div class="line-price">₹{{ cart_item.sub_total }}</div>
                      <div class="line-caption">Line total</div>
                    </div>
                  </div>
                </div>
              {% endfor %}

              <div class="cart-actions">
                <a href="{% url 'moc_app:index' %}" class="btn btn-sage-outline">Continue shopping</a>
                <a href="{% url 'cart_app:checkout' %}" class="btn btn-sage ms-auto">
                  Checkout <i class="fas fa-arrow-right ms-2"></i>
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- SUMMARY -->
        <div class="col-lg-4">
          <div class="summary-card">
            <div class="summary-head">
              <h5 class="mb-0">Order Summary</h5>
            </div>

            <div class="summary-body">
              <div class="summary-list">
                {% for cart_item in cart_items %}
                  <div class="summary-item">
                    <div class="summary-name">
                      {{ cart_item.product.name }}
                      <span class="summary-qty">x{{ cart_item.quantity }}</span>
                    </div>
                    <div class="summary-price">₹{{ cart_item.sub_total }}</div>
                  </div>
                {% endfor %}
              </div>

              <div class="summary-line">
                <span>Shipping</span>
                <span class="free">Free</span>
              </div>

              <div class="summary-total">
                <span>Total</span>
                <span>₹{{ total }}</span>
              </div>

              <a href="{% url 'cart_app:checkout' %}" class="btn btn-sage w-100 mt-3">
                Go to checkout
              </a>

              <div class="summary-note">
                Secure checkout • Fast delivery • Easy returns
              </div>
            </div>
          </div>
        </div>

      </div>
    {% endif %}
  </div>
</section>
{% endblock %}